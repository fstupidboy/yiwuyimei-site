<!-- layouts/partials/head.html -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

{{/* ---------- Derived SEO values (description, image, type, robots) ---------- */}}
{{ $site := .Site }}
{{ $desc := .Description }}
{{ if not $desc }}{{ $desc = .Params.description }}{{ end }}
{{ if not $desc }}{{ $desc = .Summary }}{{ end }}
{{ if not $desc }}{{ $desc = $site.Params.description }}{{ end }}

{{ $ogImage := "" }}
{{ with .Params.cover.image }}{{ $ogImage = . }}{{ end }}
{{ if eq $ogImage "" }}
  {{ with .Params.cover.gallery }}
    {{ $first := index . 0 }}
    {{ if $first }}{{ $ogImage = $first }}{{ end }}
  {{ end }}
{{ end }}
{{ if eq $ogImage "" }}
  {{ with $site.Params.images }}
    {{ $first := index . 0 }}
    {{ if $first }}{{ $ogImage = $first }}{{ end }}
  {{ end }}
{{ end }}
{{ if eq $ogImage "" }}{{ $ogImage = "/images/og-default.png" }}{{ end }}

{{ $ogType := "website" }}
{{ if .IsHome }}
  {{ $ogType = "website" }}
{{ else if eq .Section "products" }}
  {{ $ogType = "product" }}
{{ else }}
  {{ $ogType = "article" }}
{{ end }}

{{ $robots := "index,follow" }}
{{ if or .Params.noindex .Draft }}{{ $robots = "noindex,nofollow" }}{{ end }}

<title>{{ .Title }} | {{ .Site.Title }}</title>

<!-- 网站图标 favicon -->
<link rel="icon" href="/favicon.png" type="image/png" />

<!-- Canonical & hreflang -->
<link rel="canonical" href="{{ .Permalink }}" />
<link rel="alternate" href="{{ .Permalink }}" hreflang="en-us" />
<link rel="alternate" href="{{ .Permalink }}" hreflang="x-default" />

<!-- 公共样式 -->
<link rel="stylesheet" href="/css/extra.css" />
<link rel="stylesheet" href="/css/footer.css" />
<link rel="stylesheet" href="/css/products.css" />
<link rel="stylesheet" href="/css/contact.css" />

<!-- ✅ SEO 基础信息 -->
<meta name="description" content="{{ $desc }}">
<meta name="keywords" content="China wholesale, Yiwu exporter, fans supplier, humidifier wholesale, aroma diffuser manufacturer, home appliances, global sourcing, USA Europe Japan Korea, high quality, affordable price">
<meta name="author" content="YIWUYIMEI Technology Co. Ltd.">
<meta name="robots" content="{{ $robots }}" />

<!-- ✅ Open Graph（社交媒体分享用） -->
<meta property="og:site_name" content="{{ .Site.Title }}" />
<meta property="og:title" content="{{ .Title }} | {{ .Site.Title }}" />
<meta property="og:description" content="{{ $desc }}" />
<meta property="og:image" content="{{ $ogImage }}" />
<meta property="og:type" content="{{ $ogType }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:locale" content="en_US" />

<!-- ✅ Twitter 卡片 -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ .Title }} | {{ .Site.Title }}" />
<meta name="twitter:description" content="{{ $desc }}" />
<meta name="twitter:image" content="{{ $ogImage }}" />

<link rel="stylesheet" href="/css/navbar.css" />
<link rel="stylesheet" href="/css/service.css">

<!-- Lazy-load images as a progressive enhancement -->
<script>
  window.addEventListener('load', function () {
    const images = document.querySelectorAll('img:not([loading])');
    images.forEach(img => img.setAttribute('loading', 'lazy'));
  });
  
  // Add rel=noopener to external links
  document.addEventListener('click', function(e) {
    if (e.target && e.target.tagName === 'A') {
      const a = e.target;
      if (a.target === '_blank' && !a.rel.includes('noopener')) {
        a.rel += (a.rel ? ' ' : '') + 'noopener';
      }
    }
  });
</script>

<!-- Umami analytics (privacy-friendly) -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="c58d2a0b-08c1-487c-bf08-883224e27198"></script>

{{/* ---------- JSON-LD: Organization on home, Product on product pages ---------- */}}
{{ if .IsHome }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "logo": "/favicon.png",
  "sameAs": []
}
</script>
{{ else if and (eq .Section "products") .IsPage }}
{{/* Compute a safe SKU even if .File is nil (e.g., head used on virtual pages) */}}
{{ $sku := (urlize .Title) }}
{{ with .File }}{{ $sku = .BaseFileName }}{{ end }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ printf "%q" .Title }},
  "description": {{ printf "%q" $desc }},
  "category": {{ printf "%q" (default "" .Params.product_type) }},
  "brand": { "@type": "Brand", "name": "YiwuYimei" },
  "sku": {{ printf "%q" $sku }},
  "url": {{ printf "%q" .Permalink }},
  "image": [
    {{- $imgs := slice -}}
    {{- with .Params.cover.image }}{{ $imgs = $imgs | append . }}{{ end -}}
    {{- with .Params.cover.gallery }}{{ range . }}{{ $imgs = $imgs | append . }}{{ end }}{{ end -}}
    {{- if eq (len $imgs) 0 }}{{ $imgs = $imgs | append $ogImage }}{{ end -}}
    {{- range $i, $img := $imgs -}}{{ if gt $i 0 }}, {{ end }}{{ printf "%q" $img }}{{- end -}}
  ]
}
</script>
{{ else if and (eq .Section "posts") .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ printf "%q" .Title }},
  "description": {{ printf "%q" $desc }},
  "datePublished": {{ printf "%q" (.PublishDate | default .Date | time.Format "2006-01-02T15:04:05Z07:00") }},
  "dateModified": {{ printf "%q" (.Lastmod | time.Format "2006-01-02T15:04:05Z07:00") }},
  "mainEntityOfPage": {"@type":"WebPage","@id": {{ printf "%q" .Permalink }}},
  "author": {"@type":"Organization","name":"YiwuYimei"},
  "publisher": {"@type":"Organization","name":"YiwuYimei","logo":{"@type":"ImageObject","url":"/favicon.png"}},
  "image": {{ printf "%q" $ogImage }}
}
</script>
{{ else if and (eq .Section "services") .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Service",
  "name": {{ printf "%q" .Title }},
  "description": {{ printf "%q" $desc }},
  "provider": {"@type":"Organization","name":"YiwuYimei","url": {{ printf "%q" .Site.BaseURL }}},
  "areaServed": "Worldwide",
  "serviceType": {{ printf "%q" .Title }}
}
</script>
{{ end }}
